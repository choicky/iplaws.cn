!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.iDisqus=t():e.iDisqus=t()}(this,function(){return function(e){function t(a){if(o[a])return o[a].exports;var n=o[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.d=function(e,o,a){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,o){o(1),e.exports=o(2)},function(e,t){},function(e,t,o){(function(e){var a;/*!
 * v 0.1.1
 * https://github.com/fooleap/disqus-php-api
 *
 * Copyright 2017 fooleap
 * Released under the MIT license
 */
!function(n){"use strict";function i(e){var t=d.createElement("a");return t.href=e,t}function r(e,t,o){var a=new XMLHttpRequest;return a.open("GET",encodeURI(e)),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&t(a.responseText)},a.onerror=o,a.send(),a}function s(e,t,o,a){var n="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),i=new XMLHttpRequest;return i.open("POST",e),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&o(i.responseText)},i.onerror=a,i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(n),i}function l(e,t,o){[].forEach.call(e,function(e){e.addEventListener(t,o,!1)})}function m(e,t,o){[].forEach.call(e,function(e){e.removeEventListener(t,o,!1)})}function c(e){var t={prefix:"",suffix:"前",seconds:"几秒",minute:"1分钟",minutes:"%d分钟",hour:"1小时",hours:"%d小时",day:"1天",days:"%d天",month:"1个月",months:"%d个月",year:"1年",years:"%d年"},o=function(e,o){return t[e]&&t[e].replace(/%d/i,Math.abs(Math.round(o)))},a=document.getElementsByClassName("timeago");for(var n in a){var i=a[n];"object"==typeof i&&(i.innerHTML=function(e){if(e){e=e.replace(/\.\d+/,""),e=e.replace(/-/,"/").replace(/-/,"/"),e=e.replace(/T/," ").replace(/Z/," UTC"),e=e.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),e=new Date(1e3*e||e);var a=new Date,n=.001*(a.getTime()-e)>>0,i=n/60,r=i/60,s=r/24,l=s/365;return t.prefix+(n<45&&o("seconds",n)||n<90&&o("minute",1)||i<45&&o("minutes",i)||i<90&&o("hour",1)||r<24&&o("hours",r)||r<42&&o("day",1)||s<30&&o("days",s)||s<45&&o("month",1)||s<365&&o("months",s/30)||l<1.5&&o("year",1)||o("years",l))+t.suffix}}(i.getAttribute("title")||i.getAttribute("datetime")))}setTimeout(c,6e4)}var d=document,u=localStorage;!function(e){"function"!=typeof e.matches&&(e.matches=e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this,o=(t.document||t.ownerDocument).querySelectorAll(e),a=0;o[a]&&o[a]!==t;)++a;return Boolean(o[a])}),"function"!=typeof e.closest&&(e.closest=function(e){for(var t=this;t&&1===t.nodeType;){if(t.matches(e))return t;t=t.parentNode}return null})}(window.Element.prototype);var p=function(){this.dom=arguments[0],this.init()};p.prototype={init:function(){var e=this;e.name=u.getItem("name"),e.email=u.getItem("email"),e.url=u.getItem("url"),e.avatar=u.getItem("avatar"),e.logged_in=u.getItem("logged_in");var t=e.dom.getElementsByClassName("comment-box");"true"==e.logged_in?[].forEach.call(t,function(t){t.querySelector(".comment-form-wrapper").classList.add("logged-in"),t.querySelector(".comment-form-name").value=e.name,t.querySelector(".comment-form-email").value=e.email,t.querySelector(".comment-form-url").value=e.url,t.querySelector(".comment-avatar-image").src=e.avatar}):([].forEach.call(t,function(t){t.querySelector(".comment-form-wrapper").classList.remove("logged-in"),t.querySelector(".comment-form-name").value=e.name,t.querySelector(".comment-form-email").value=e.email,t.querySelector(".comment-form-url").value=e.url,t.querySelector(".comment-avatar-image").src=e.avatar?e.avatar:t.querySelector(".comment-avatar-image").src}),u.setItem("logged_in","false"))},reset:function(){u.setItem("logged_in","false"),this.init()},submit:function(e){if("false"==this.logged_in)return!(!/\S/i.test(e.name)||!/^([\w-_]+(?:\.[\w-_]+)*)@((?:[a-z0-9]+(?:-[a-zA-Z0-9]+)*)+\.[a-z]{2,6})$/i.test(e.email)||(u.setItem("name",e.name),u.setItem("email",e.email),u.setItem("url",e.url),u.setItem("avatar",e.avatar),u.setItem("logged_in","true"),this.init(),0))}};var f=function(){var e=this;e.opts="object"==typeof arguments[1]?arguments[1]:arguments[0],e.dom=d.getElementById("string"==typeof arguments[0]?arguments[0]:"comment"),e.opts.api="/"==e.opts.api.slice(-1)?e.opts.api.slice(0,-1):e.opts.api,e.opts.site=e.opts.site?e.opts.site:location.origin,e.opts.url=e.opts.url?e.opts.url:location.pathname,e.opts.title=e.opts.title?e.opts.title:d.title,e.opts.desc=e.opts.desc?e.opts.desc:d.querySelector('[name="description"]')?d.querySelector('[name="description"]').content:"",e.opts.mode=e.opts.mode?e.opts.mode:1,e.opts.timeout=e.opts.timeout?e.opts.timeout:3e3,e.opts.toggle=e.opts.toggle?d.getElementById(e.opts.toggle):null,e.opts.emoji_path=e.opts.emoji_path?e.opts.emoji_path:"https://assets-cdn.github.com/images/icons/emoji/unicode/",e.emoji=e._emoji(),e.stat={current:"idisqus",loaded:!1,loading:!1,offsetTop:0,thread:null,next:null,message:null,mediaHtml:null,unload:[],root:[],count:0,imageSize:[],disqusLoaded:!1},window.disqus_config=function(){this.page.url=e.opts.site+e.opts.url,this.page.title=e.opts.title,this.callbacks.onReady.push(function(){e.stat.current="disqus",e.stat.disqusLoaded=!0,e.dom.querySelector("#idisqus").style.display="none",e.dom.querySelector("#disqus_thread").style.display="block",3==e.opts.mode&&e.opts.toggle&&(e.opts.toggle.disabled="",e.opts.toggle.checked=!0,e.opts.toggle.addEventListener("change",e.handle.toggle,!1))})},e.opts.init&&e.init()};f.prototype.init=function(){var e=this;if(e.dom){var t="";switch(e.emoji.forEach(function(e){t+='<li class="emojione-item" title="'+e.title+'" data-code="'+e.code+'"><img class="emojione-item-image" src="'+e.url+'" /></li>'}),e.dom.innerHTML='<div class="comment loading" id="idisqus">\n    <div class="loading-container" data-tip="正在加载评论……"></div>\n    <div class="comment-header"><span class="comment-header-item" id="comment-count">评论</span><a target="_blank" class="comment-header-item" id="comment-link">Disqus 讨论区</a></div>\n    <div class="comment-box">\n        <div class="comment-avatar avatar"><img class="comment-avatar-image" src="https://a.disquscdn.com/images/noavatar92.png"></div>\n        <div class="comment-form">\n            <div class="comment-form-wrapper">\n                <textarea class="comment-form-textarea" placeholder="加入讨论……"></textarea>\n                <div class="comment-image">\n                    <ul class="comment-image-list"></ul>\n                    <div class="comment-image-progress">\n                        <div class="comment-image-loaded"></div>\n                    </div>\n                </div>\n                <div class="comment-actions">\n                    <div class="comment-actions-group">\n                        <input id="emoji-input" class="comment-actions-input" type="checkbox"> \n                        <label class="comment-actions-label emojione" for="emoji-input" title="选择表情">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M512 1024c-282.713043 0-512-229.286957-512-512s229.286957-512 512-512c282.713043 0 512 229.286957 512 512S792.486957 1024 512 1024zM512 44.521739c-258.226087 0-467.478261 209.252174-467.478261 467.478261 0 258.226087 209.252174 467.478261 467.478261 467.478261s467.478261-209.252174 467.478261-467.478261C979.478261 253.773913 768 44.521739 512 44.521739z"></path>\n                                <path d="M801.391304 554.295652c0 160.278261-129.113043 289.391304-289.391304 289.391304s-289.391304-129.113043-289.391304-289.391304L801.391304 554.295652z"></path>\n                                <path d="M674.504348 349.495652m-57.878261 0a2.6 2.6 0 1 0 115.756522 0 2.6 2.6 0 1 0-115.756522 0Z"></path>\n                                <path d="M347.269565 349.495652m-57.878261 0a2.6 2.6 0 1 0 115.756522 0 2.6 2.6 0 1 0-115.756522 0Z"></path>\n                            </svg>\n                            <ul class="emojione-list">'+t+'</ul>\n                        </label>\n                        <input id="upload-input" class="comment-actions-input comment-image-input" type="file" accept="image/*" name="file"> \n                        <label class="comment-actions-label" for="upload-input" title="上传图片">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M15.515152 15.515152 15.515152 15.515152 15.515152 15.515152Z"></path>\n                                <path d="M15.515152 139.636364l0 806.787879 992.969697 0 0-806.787879-992.969697 0zM946.424242 884.363636l-868.848485 0 0-682.666667 868.848485 0 0 682.666667zM698.181818 356.848485c0-51.417212 41.673697-93.090909 93.090909-93.090909s93.090909 41.673697 93.090909 93.090909c0 51.417212-41.673697 93.090909-93.090909 93.090909s-93.090909-41.673697-93.090909-93.090909zM884.363636 822.30303l-744.727273 0 186.181818-496.484848 248.242424 310.30303 124.121212-93.090909z"></path>\n                            </svg>\n                        </label>\n                    </div>\n                    <div class="comment-actions-form">\n                        <label class="comment-actions-label exit" title="重置访客信息">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48" height="48">\n                                <path d="M348.870666 210.685443l378.570081 0c32.8205 0 58.683541 26.561959 58.683541 58.683541 0 162.043606 0 324.804551 0 486.848157 0 32.81129-26.561959 58.674331-58.683541 58.674331L348.870666 814.891472c-10.477632 0-18.850323-8.363482-18.850323-18.841114l0-37.728276c0-10.477632 8.372691-18.841114 18.850323-18.841114l343.645664 0c10.477632 0 18.850323-8.372691 18.850323-18.850323L711.366653 304.983109c0-10.477632-8.372691-18.841114-18.850323-18.841114L348.870666 286.141996c-10.477632 0-18.850323-8.363482-18.850323-18.841114l0-37.728276C329.98248 219.095997 338.393034 210.685443 348.870666 210.685443z"></path>\n                                <path d="M128.152728 526.436804l112.450095 112.450095c6.985088 6.985088 19.567661 6.985088 26.552749 0l26.561959-26.561959c6.985088-6.985088 6.985088-19.567661 0-26.552749l-34.925441-34.925441L494.168889 550.84675c10.477632 0 18.850323-8.372691 18.850323-18.850323l0-37.719066c0-10.477632-8.372691-18.850323-18.850323-18.850323L258.754229 475.427036l34.925441-34.925441c6.985088-6.985088 6.985088-19.567661 0-26.552749l-26.561959-26.524097c-6.985088-6.985088-19.567661-6.985088-26.552749 0L128.152728 499.875868C120.431883 506.859933 120.431883 519.451716 128.152728 526.436804z"></path>\n                            </svg>\n                        </label>\n                        <button class="comment-form-submit">\n                            <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M565.747623 792.837176l260.819261 112.921839 126.910435-845.424882L66.087673 581.973678l232.843092 109.933785 562.612725-511.653099-451.697589 563.616588-5.996574 239.832274L565.747623 792.837176z" fill="#ffffff"></path>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class="comment-login"><input class="comment-form-input comment-form-name" type="text" placeholder="名字（必填）" autocomplete="name"><input class="comment-form-input comment-form-email" type="email" placeholder="邮箱（必填）" autocomplete="email"><input class="comment-form-input comment-form-url" type="url" placeholder="网址（可选）" autocomplete="url"></div>\n        </div>\n    </div>\n    <ul id="comments" class="comment-list"></ul>\n    <a href="javascript:;" class="comment-loadmore">加载更多</a>\n</div>\n<div class="comment" id="disqus_thread"></div>',e.guest=new p(e.dom),e.box=e.dom.querySelector(".comment-box").outerHTML.replace(/<label class="comment-actions-label exit"(.|\n)*<\/label>\n/,"").replace("comment-form-wrapper","comment-form-wrapper editing").replace(/加入讨论……/,""),e.handle={guestReset:e.guest.reset.bind(e.guest),loadMore:e.loadMore.bind(e),post:e.post.bind(e),postThread:e.postThread.bind(e),remove:e.remove.bind(e),show:e.show.bind(e),toggle:e.toggle.bind(e),upload:e.upload.bind(e),verify:e.verify.bind(e),field:e.field,focus:e.focus},e.opts.mode){case 1:e.disqus();break;case 2:e.getlist();break;case 3:e.getlist(),e.disqus();break;default:e.disqus()}}},f.prototype.toggle=function(){var e=this;"disqus"==e.stat.current?(e.stat.current="idisqus",e.dom.querySelector("#idisqus").style.display="block",e.dom.querySelector("#disqus_thread").style.display="none"):e.disqus()},f.prototype.disqus=function(){var e=this,t=e.dom.querySelector(".loading-container").dataset.tip;if(e.opts.site!=location.origin)return void(1==e.opts.mode&&e.getlist());if(e.stat.disqusLoaded)e.stat.current="disqus",e.dom.querySelector("#idisqus").style.display="none",e.dom.querySelector("#disqus_thread").style.display="block";else{t="尝试连接 Disqus……";var o=d.createElement("script");o.src="//"+e.opts.forum+".disqus.com/embed.js",o.dataset.timestamp=Date.now(),o.onload=function(){e.stat.disqusLoaded=!0,t="连接成功，加载 Disqus 评论框……"},o.onerror=function(){1==e.opts.mode&&(t="连接失败，加载简易评论框……",e.getlist())};var a=new XMLHttpRequest;a.open("GET","//disqus.com/next/config.json?"+Date.now(),!0),a.timeout=e.opts.timeout,a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(d.head||d.body).appendChild(o)},a.ontimeout=function(){a.abort(),1==e.opts.mode&&(t="连接超时，加载简易评论框……",e.getlist())},a.onerror=function(){1==e.opts.mode&&(t="连接失败，加载简易评论框……",e.getlist())},a.send()}},f.prototype.count=function(){var e=this,t=d.querySelectorAll("[data-disqus-url]"),o=t.length;if(o>0){for(var a=[],n=0;n<o;n++)a[n]=t[n].dataset.disqusUrl;r(e.opts.api+"/count.php?links="+a.join(","),function(e){JSON.parse(e).response.forEach(function(e){var t=d.querySelector('[data-disqus-url="'+i(e.link).pathname+'"]');t&&(t.innerHTML=e.posts)})},function(){})}},f.prototype.popular=function(){var e=this;e.opts.popular&&r(e.opts.api+"/popular.php",function(t){var o=JSON.parse(t);if(0==o.code){var a=o.response,n="";a.forEach(function(e){n+='<li><a href="'+i(e.link).pathname+'" title="'+e.title+'">'+e.title+"</a></li>"}),e.opts.popular.innerHTML=n}},function(){})},f.prototype._emoji=function(){var e=this.opts.emoji_path;return[{code:":smile:",title:"笑脸",url:e+"1f604.png"},{code:":mask:",title:"生病",url:e+"1f637.png"},{code:":joy:",title:"破涕为笑",url:e+"1f602.png"},{code:":stuck_out_tongue_closed_eyes:",title:"吐舌",url:e+"1f61d.png"},{code:":flushed:",title:"脸红",url:e+"1f633.png"},{code:":scream:",title:"恐惧",url:e+"1f631.png"},{code:":pensive:",title:"失望",url:e+"1f614.png"},{code:":unamused:",title:"无语",url:e+"1f612.png"},{code:":grin:",title:"露齿笑",url:e+"1f601.png"},{code:":heart_eyes:",title:"色",url:e+"1f60d.png"},{code:":sweat:",title:"汗",url:e+"1f613.png"},{code:":smirk:",title:"得意",url:e+"1f60f.png"},{code:":relieved:",title:"满意",url:e+"1f60c.png"},{code:":rolling_eyes:",title:"翻白眼",url:e+"1f644.png"},{code:":ok_hand:",title:"OK",url:e+"1f44c.png"},{code:":v:",title:"胜利",url:e+"270c.png"}]},f.prototype.getlist=function(){var e=this;e.stat.loading=!0,e.dom.querySelector("#idisqus").style.display="block",e.dom.querySelector("#disqus_thread").style.display="none",r(e.opts.api+"/getcomments.php?link="+e.opts.url+(e.stat.next?"&cursor="+e.stat.next:""),function(t){var o=JSON.parse(t);if(0===o.code){e.stat.offsetTop=d.documentElement.scrollTop||d.body.scrollTop,e.stat.thread=o.thread,e.stat.count=o.posts,e.dom.querySelector("#idisqus").classList.remove("loading"),e.dom.querySelector("#comment-link").href=o.link,e.dom.querySelector("#comment-count").innerHTML=e.stat.count+" 条评论";var a=e.dom.querySelector(".comment-loadmore"),n=e.stat.unload.length>0?o.response.concat(e.stat.unload):o.response?o.response:[];if(e.stat.unload=[],e.stat.root=[],n.forEach(function(t){e.load(t),t.parent||e.stat.root.unshift(t.id)}),o.cursor.hasPrev?e.stat.root.forEach(function(t){e.dom.querySelector(".comment-list").appendChild(e.dom.querySelector("#comment-"+t))}):(a.addEventListener("click",e.handle.loadMore,!1),e.dom.querySelector(".exit").addEventListener("click",e.handle.guestReset,!1),e.dom.querySelector(".comment-form-textarea").addEventListener("blur",e.handle.focus,!1),e.dom.querySelector(".comment-form-textarea").addEventListener("focus",e.handle.focus,!1),e.dom.querySelector(".comment-form-email").addEventListener("blur",e.handle.verify,!1),e.dom.querySelector(".comment-form-submit").addEventListener("click",e.handle.post,!1),e.dom.querySelector(".comment-image-input").addEventListener("change",e.handle.upload,!1),l(e.dom.getElementsByClassName("emojione-item"),"click",e.handle.field)),o.cursor.hasNext?(e.stat.next=o.cursor.next,a.classList.remove("loading")):(e.stat.next=null,a.classList.add("hide")),0==n.length)return;window.scrollTo(0,e.stat.offsetTop),c(),/^#disqus|^#comment/.test(location.hash)&&!o.cursor.hasPrev&&window.scrollTo(0,e.dom.querySelector(location.hash).offsetTop),e.stat.loading=!1,e.stat.loaded=!0}else 2===o.code&&e.create()},function(){})},f.prototype.load=function(e){var t=this,o=e.parent?{name:t.dom.querySelector('.comment-item[data-id="'+e.parent+'"]')?'<a class="at" href="#'+t.dom.querySelector('.comment-item[data-id="'+e.parent+'"]').id+'">@'+t.dom.querySelector('.comment-item[data-id="'+e.parent+'"]').dataset.name+"</a>":"",dom:t.dom.querySelector('.comment-item[data-id="'+e.parent+'"] .comment-item-children'),insert:"beforeend"}:{name:"",dom:t.dom.querySelector(".comment-list"),insert:"afterbegin"};if(o.dom){var a="";e.media.forEach(function(e){a+='<a class="comment-item-imagelink" target="_blank" href="'+e+'" ><img class="comment-item-image" src="'+e+'?imageView2/2/h/200"></a>'}),a='<div class="comment-item-images">'+a+"</div>";var n='<li class="comment-item" data-id="'+e.id+'" data-name="'+e.name+'" id="comment-'+e.id+'"><div class="comment-item-avatar"><img src="'+e.avatar+'"></div><div class="comment-item-main"><div class="comment-item-header"><a class="comment-item-name" title="'+e.name+'" rel="nofollow" target="_blank" href="'+(e.url?e.url:"javascript:;")+'">'+e.name+'</a><span class="comment-item-bullet"> • </span><span class="comment-item-time timeago" datetime="'+e.createdAt+'"></span><span class="comment-item-bullet"> • </span><a class="comment-item-reply" href="javascript:;">回复</a></div><div class="comment-item-content">'+e.message+a+'</div><ul class="comment-item-children"></ul></div></li>';o.dom.insertAdjacentHTML(o.insert,n),t.dom.querySelector('.comment-item[data-id="'+e.id+'"] .comment-item-reply').addEventListener("click",t.handle.show,!1)}else t.stat.unload.push(e)},f.prototype.loadMore=function(e){var t=this;t.stat.loading||(e.currentTarget.classList.add("loading"),t.getlist())},f.prototype.focus=function(e){var t=e.currentTarget.closest(".comment-form-wrapper");t.classList.add("editing"),t.classList.contains("focus")?t.classList.remove("focus"):t.classList.add("focus")},f.prototype.field=function(e){var t=e.currentTarget,o=t.closest(".comment-form").querySelector(".comment-form-textarea");o.value+=t.dataset.code,o.focus()},f.prototype.show=function(e){var t=this,o=t.dom.querySelector(".comment-item .comment-box");if(o){var a=o.closest(".comment-item");o.parentNode.removeChild(o);var n=a.querySelector(".comment-item-cancel");n.outerHTML=n.outerHTML.replace("cancel","reply"),a.querySelector(".comment-item-reply").addEventListener("click",t.handle.show,!1)}var i=e.currentTarget,r=i.closest(".comment-item"),s=t.box.replace(/emoji-input/g,"emoji-input-"+r.dataset.id).replace(/upload-input/g,"upload-input-"+r.dataset.id);r.querySelector(".comment-item-children").insertAdjacentHTML("beforebegin",s),i.outerHTML=i.outerHTML.replace("reply","cancel"),t.guest.init(),r.querySelector(".comment-form-textarea").addEventListener("blur",t.handle.focus,!1),r.querySelector(".comment-form-textarea").addEventListener("focus",t.handle.focus,!1),r.querySelector(".comment-form-email").addEventListener("blur",t.handle.verify,!1),r.querySelector(".comment-form-submit").addEventListener("click",t.handle.post,!1),r.querySelector(".comment-image-input").addEventListener("change",t.handle.upload,!1),l(r.getElementsByClassName("emojione-item"),"click",t.handle.field),r.querySelector(".comment-form-textarea").focus(),r.querySelector(".comment-item-cancel").addEventListener("click",function(){r.querySelector(".comment-box").outerHTML="",this.outerHTML=this.outerHTML.replace("cancel","reply"),r.querySelector(".comment-item-reply").addEventListener("click",t.handle.show,!1)},!1)},f.prototype.verify=function(e){var t=this,o=e.currentTarget.closest(".comment-box"),a=o.querySelector(".comment-avatar-image"),n=o.querySelector(".comment-form-email");/^([\w-_]+(?:\.[\w-_]+)*)@((?:[a-z0-9]+(?:-[a-zA-Z0-9]+)*)+\.[a-z]{2,6})$/i.test(n.value)&&r(t.opts.api+"/getgravatar.php?email="+n.value,function(e){"false"==e||(a.src=e)},function(){})},f.prototype.upload=function(e){var t=this,o=e.currentTarget,a=o.closest(".comment-box"),n=a.querySelector(".comment-image-progress"),i=a.querySelector(".comment-image-loaded"),r=a.querySelector(".comment-form-wrapper");if(0!==o.files.length&&-1==t.stat.imageSize.indexOf(s)){n.style.width="80px";var s=o.files[0].size;r.classList.add("expanded");var l=new FormData;l.append("file",o.files[0]);var m=o.files[0].name,c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var e=JSON.parse(c.responseText);if(0==e.code){t.stat.imageSize.push(s);var o=e.response[m].url,n=new Image;n.src=o,n.onload=function(){a.querySelector('[data-image-size="'+s+'"]').innerHTML='<img class="comment-image-object" src="'+o+'">',a.querySelector('[data-image-size="'+s+'"]').dataset.imageUrl=o,a.querySelector('[data-image-size="'+s+'"]').classList.remove("loading"),a.querySelector('[data-image-size="'+s+'"]').addEventListener("click",t.handle.remove,!1)}}}},c.upload.addEventListener("progress",function(e){i.style.width=Math.ceil(e.loaded/e.total*100)+"%"},!1),c.upload.addEventListener("load",function(e){i.style.width=0,n.style.width=0;var t='<li class="comment-image-item loading" data-image-size="'+s+'">\n    <svg version="1.1" class="comment-image-object" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n        width="24px" height="30px" viewBox="0 0 24 30" style="enable-background: new 0 0 50 50;" xml:space="preserve">\n        <rect x="0" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n        <rect x="8" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n        <rect x="16" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n    </svg>\n</li>\n';a.querySelector(".comment-image-list").insertAdjacentHTML("beforeend",t)},!1),c.open("POST",t.opts.api+"/upload.php",!0),c.send(l)}},f.prototype.remove=function(e){var t=this,o=e.currentTarget.closest(".comment-image-item"),a=e.currentTarget.closest(".comment-form-wrapper");o.parentNode.removeChild(o),t.stat.imageSize=[];var n=a.getElementsByClassName("comment-image-item");[].forEach.call(n,function(e,o){t.stat.imageSize[o]=e.dataset.imageSize}),0==t.stat.imageSize.length&&a.classList.remove("expanded")},f.prototype.post=function(e){var t=this,o=e.currentTarget.closest(".comment-item")||e.currentTarget.closest(".comment-box"),a={name:o.querySelector(".comment-form-name").value,email:o.querySelector(".comment-form-email").value,url:o.querySelector(".comment-form-url").value,avatar:o.querySelector(".comment-avatar-image").src};if("false"!=t.guest.logged_in||0!=t.guest.submit(a)){t.stat.message||t.stat.mediaHtml||(t.box=t.dom.querySelector(".comment-box").outerHTML.replace(/<label class="comment-actions-label exit"(.|\n)*<\/label>\n/,"").replace("comment-form-wrapper","comment-form-wrapper editing").replace(/加入讨论……/,""));var n=o.querySelector(".comment-form-textarea").value,i=o.dataset.id?o.dataset.id:"",r=o.getElementsByClassName("comment-image-item"),m=[],d="";if([].forEach.call(r,function(e,t){m[t]=e.dataset.imageUrl,d+=" "+e.dataset.imageUrl}),t.guest.name||t.guest.email){if(0==m.length&&""==n)return void o.querySelector(".comment-form-textarea").focus();var u=n;t.emoji.forEach(function(e){u=u.replace(e.code,'<img class="emojione" src="'+e.url+'" />')});var p={url:t.guest.url?t.guest.url:"",name:t.guest.name,avatar:t.guest.avatar,id:"preview",parent:i,createdAt:(new Date).toJSON(),message:"<p>"+u+"</p>",media:m};t.load(p),t.stat.message=n,t.stat.mediaHtml=o.querySelector(".comment-image-list").innerHTML,c(),n+=d,i?o.querySelector(".comment-item-cancel").click():(o.querySelector(".comment-form-textarea").value="",o.querySelector(".comment-image-list").innerHTML="",o.querySelector(".comment-form-wrapper").classList.remove("expanded","editing"));var f={thread:t.stat.thread,parent:i,message:n,name:t.guest.name,email:t.guest.email,url:t.guest.url,link:t.opts.url,title:t.opts.title};s(t.opts.api+"/postcomment.php",f,function(e){var o=JSON.parse(e);if(0===o.code){var a=t.dom.querySelector('.comment-item[data-id="preview"]');a.parentNode.removeChild(a),t.stat.count+=1,t.dom.querySelector("#comment-count").innerHTML=t.stat.count+" 条评论",t.load(o.response),t.stat.message=null,t.stat.mediaHtml=null,c()}else if(2===o.code){if(o.response.indexOf("email")>-1)return;if(o.response.indexOf("message")>-1)return}},function(){t.dom.querySelector('.comment-item[data-id="preview"]').outerHTML="",i?o.querySelector(".comment-item-reply").click():o.querySelector(".comment-form-wrapper").classList.add("editing"),o.querySelector(".comment-form-textarea").value=t.stat.message,t.stat.mediaHtml&&(o.querySelector(".comment-form-wrapper").classList.add("expanded"),o.querySelector(".comment-image-list").innerHTML=t.stat.mediaHtml,l(o.getElementsByClassName("comment-image-item"),"click",t.remove.bind(t)))})}}},f.prototype.create=function(){var e=this;e.dom.querySelector("#idisqus").classList.remove("loading"),e.dom.querySelector("#idisqus").innerHTML='<div class="comment-header"><span class="comment-header-item">创建 Thread</span></div><div class="comment-thread-form"><p>由于 Disqus 没有本页面的相关 Thread，故需先创建 Thread</p><div class="comment-form-item"><label class="comment-form-label">url:</label><input class="comment-form-input" id="thread-url" name="url" value="'+e.opts.site+e.opts.url+'" /></div><div class="comment-form-item"><label class="comment-form-label">title:</label><input class="comment-form-input" id="thread-title" name="title" value="'+e.opts.title+'" /></div><div class="comment-form-item"><label class="comment-form-label">slug:</label><input class="comment-form-input" id="thread-slug" name="slug" value="'+e.opts.slug+'" /></div><div class="comment-form-item"><label class="comment-form-label">message:</label><textarea class="comment-form-textarea" id="thread-message" name="message">'+e.opts.desc+'</textarea></div><button id="thread-submit" class="comment-form-submit">提交</button></div>',e.dom.querySelector("#thread-submit").addEventListener("click",e.handle.postThread,!1)},f.prototype.postThread=function(){var e=this,t={url:e.dom.querySelector("#thread-url").value,title:e.dom.querySelector("#thread-title").value,slug:e.dom.querySelector("#thread-slug").value,message:e.dom.querySelector("#thread-message").value};s(e.opts.api+"/createthread.php",t,function(e){0===JSON.parse(e).code&&setTimeout(function(){location.reload()},2e3)},function(){})},f.prototype.destroy=function(){var e=this;e.dom.querySelector(".exit").removeEventListener("click",e.handle.guestReset,!1),m(e.dom.getElementsByClassName("comment-form-textarea"),"blur",e.handle.focus),m(e.dom.getElementsByClassName("comment-form-textarea"),"focus",e.handle.focus),m(e.dom.getElementsByClassName("comment-form-email"),"blur",e.handle.verify),m(e.dom.getElementsByClassName("comment-form-submit"),"click",e.handle.post),m(e.dom.getElementsByClassName("comment-image-input"),"change",e.handle.upload),m(e.dom.getElementsByClassName("comment-item-reply"),"click",e.handle.show),m(e.dom.getElementsByClassName("comment-loadmore"),"click",e.handle.loadMore),m(e.dom.getElementsByClassName("emojione-item"),"click",e.handle.field),e.dom.innerHTML="",delete e.box,delete e.dom,delete e.emoji,delete e.guest,delete e.handle,delete e.opts,delete e.stat},"object"==typeof e&&e&&"object"==typeof t&&t?e.exports=f:void 0!==(a=function(){return f}.call(t,o,t,e))&&(e.exports=a)}(window)}).call(t,o(3)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}])});